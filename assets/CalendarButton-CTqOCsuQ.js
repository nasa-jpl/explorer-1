import{d as O,S as D,_ as U,P as Y,o as S,h as M,i as C,m as R}from"./iframe-BaEhLE_2.js";import{l as N}from"./lodash-CriL_C5H.js";import{B as I}from"./BaseButton-wIzJ7QsQ.js";var _={FREQUENCY:{DAILY:"DAILY",WEEKLY:"WEEKLY",MONTHLY:"MONTHLY",YEARLY:"YEARLY"}},c={DATE:"YYYYMMDD",TIME:"ThhmmssZ",FULL:"YYYYMMDDThhmmssZ",NO_UTC_FULL:"YYYYMMDDThhmmss",OUTLOOK_DATE:"YYYY-MM-DD",OUTLOOK_TIME:"Thh:mm:ssZ",OUTLOOK_FULL:"YYYY-MM-DDThh:mm:ssZ"},h={YAHOO:"https://calendar.yahoo.com/",GOOGLE:"https://calendar.google.com/calendar/render",OUTLOOK:"https://outlook.{{host}}.com/calendar/0/deeplink/compose"},d=function(a){return a===void 0&&(a=""),"0".concat(parseInt(a.toString(),10)).slice(-2)},w=function(a,n){var r=Math.floor((n-a)/1e3),t=Math.floor(r/3600),e=r/3600%1*60;return"".concat(d(t)).concat(d(e))},j=function(a,n){var r=Math.floor((n-a)/1e3);return Math.floor(r/3600)},B=function(a){var n=a.frequency,r=a.interval,t=_.FREQUENCY;if(r)switch(n){case t.YEARLY:return r*365.25;case t.MONTHLY:return r*30.42;case t.WEEKLY:return r*7;default:return r}return 365.25*100},E=function(a,n){a===void 0&&(a=new Date);var r={YYYY:a.getUTCFullYear(),MM:d(a.getUTCMonth()+1),DD:d(a.getUTCDate()),hh:d(a.getUTCHours()),mm:d(a.getUTCMinutes()),ss:d(a.getUTCSeconds())};return Object.keys(r).reduce(function(t,e){return t.replace(e,r[e].toString())},n)},F=function(a,n){a===void 0&&(a=new Date);var r={YYYY:a.getFullYear(),MM:d(a.getMonth()+1),DD:d(a.getDate()),hh:d(a.getHours()),mm:d(a.getMinutes()),ss:d(a.getSeconds())};return Object.keys(r).reduce(function(t,e){return t.replace(e,r[e].toString())},n)},b=function(){return E(new Date,c.FULL)},x=function(a,n){var r=n*864e5,t=new Date;return t.setTime(a.getTime()+r),t},s={addLeadingZero:d,getDuration:w,getHoursDiff:j,getRecurrenceLengthDays:B,formatDate:E,formatDateNoUtc:F,getTimeCreated:b,incrementDate:x},v=function(){function a(n){var r=this;this.isAllDay=!1,this.description="",this.title="",this.location="",this.start=new Date,this.end=new Date,this.params={},this.attendees=[],this.setText=function(t){r.description=t.description||"",r.title=t.title||"",r.location=t.location||""},this.setTimestamps=function(t){r.isAllDay=!t.end,r.start=t.start,r.end=t.end||s.incrementDate(r.start,1),r.recurrence=t.recurrence},this.setParam=function(t,e){return r.params[t]=e,r},this.setText(n),this.setTimestamps(n),this.setAttendees(n)}return a.prototype.setAttendees=function(n){this.attendees=Array.isArray(n.attendees)?n.attendees:[]},a}(),T=function(a,n){return T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(r[e]=t[e])},T(a,n)};function g(a,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");T(a,n);function r(){this.constructor=a}a.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}var p=function(){return p=Object.assign||function(n){for(var r,t=1,e=arguments.length;t<e;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])}return n},p.apply(this,arguments)};function l(a,n,r){if(r||arguments.length===2)for(var t=0,e=n.length,i;t<e;t++)(i||!(t in n))&&(i||(i=Array.prototype.slice.call(n,0,t)),i[t]=n[t]);return a.concat(i||Array.prototype.slice.call(n))}var A=function(a,n,r){n===void 0&&(n=";"),r===void 0&&(r=function(i){return i});var t=[];for(var e in a)a.hasOwnProperty(e)&&a[e]!==void 0&&t.push("".concat(e,"=").concat(r(a[e])));return t.join(n)},H=function(a){var n=Object.keys(a).filter(function(r){return a[r]!==null}).reduce(function(r,t){var e;return p(p({},r),(e={},e[t]=a[t],e))},{});return A(n,"&",encodeURIComponent)},V=function(a){return A(a,";")},G=function(a){return a.map(function(n){var r=n.email,t=n.name;return t?"".concat(t," <").concat(r,">"):r})},q=function(a){return[a[0].toUpperCase(),a.slice(-a.length+1).toLowerCase()].join("")},f={toParamString:A,toQueryString:H,toIcsParamString:V,toMailtoList:G,toProperCase:q},K=function(a){return a===void 0&&(a=""),a.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/[,;]/g,"\\$&")},Q=function(){return Math.random().toString(36).substr(2)},k=function(){return typeof window<"u"?window.location.host:"datebook"},Z=function(a){var n,r,t={FREQ:a.frequency,INTERVAL:(n=a.interval)===null||n===void 0?void 0:n.toString(),COUNT:(r=a.count)===null||r===void 0?void 0:r.toString(),WKST:a.weekstart,BYDAY:a.weekdays,BYMONTHDAY:a.monthdays};return a.end&&(t.UNTIL=s.formatDate(a.end,c.FULL)),f.toIcsParamString(t)},u={formatText:K,getUid:Q,getProdId:k,getRrule:Z};(function(a){g(n,a);function n(r){var t=a.call(this,r)||this;return t.setInitialParams=function(){var e=c.DATE;t.isAllDay||(e+=c.TIME);var i=[s.formatDate(t.start,e),s.formatDate(t.end,e)].join("/");t.setParam("action","TEMPLATE").setParam("dates",i).setParam("text",t.title).setParam("details",t.description).setParam("location",t.location).setParam("allday",t.isAllDay.toString()),t.recurrence&&t.setParam("recur","RRULE:".concat(u.getRrule(t.recurrence))),t.attendees.length>0&&t.setParam("add",f.toMailtoList(t.attendees).join(","))},t.render=function(){var e=h.GOOGLE,i=f.toQueryString(t.params);return"".concat(e,"?").concat(i)},t.setInitialParams(),t}return n})(v);(function(a){g(n,a);function n(r){var t=a.call(this,r)||this;return t.setInitialParams=function(){t.setParam("v","60").setParam("title",t.title).setParam("desc",t.description).setParam("in_loc",t.location),t.setTimeParams(),t.attendees.length>0&&t.setParam("inv_list",f.toMailtoList(t.attendees).join(","))},t.setTimeParams=function(){t.isAllDay?t.setParam("dur","allday").setParam("st",s.formatDateNoUtc(t.start,c.DATE)):(t.setParam("st",s.formatDateNoUtc(t.start,c.NO_UTC_FULL)),s.getHoursDiff(t.start.getTime(),t.end.getTime())>99?t.setParam("et",s.formatDateNoUtc(t.end,c.NO_UTC_FULL)):t.setParam("dur",s.getDuration(t.start.getTime(),t.end.getTime())))},t.render=function(){var e=h.YAHOO,i=f.toQueryString(t.params);return"".concat(e,"?").concat(i)},t.setInitialParams(),t}return n})(v);(function(a){g(n,a);function n(r){var t=a.call(this,r)||this;return t.baseUrl=h.OUTLOOK,t.setInitialParams=function(){var e=c.OUTLOOK_DATE;t.isAllDay||(e+=c.OUTLOOK_TIME),t.setParam("rru","addevent").setParam("path","/calendar/action/compose").setParam("startdt",s.formatDate(t.start,e)).setParam("enddt",s.formatDate(t.end,e)).setParam("subject",t.title).setParam("body",t.description).setParam("location",t.location).setParam("allday",t.isAllDay.toString()),t.attendees.length>0&&t.setParam("to",f.toMailtoList(t.attendees).join(","))},t.setHost=function(e){return["live","office"].includes(e)&&(t.baseUrl=h.OUTLOOK.replace("{{host}}",e)),t},t.render=function(){var e=f.toQueryString(t.params);return"".concat(t.baseUrl,"?").concat(e)},t.setInitialParams(),t.setHost("live"),t}return n})(v);var $=function(a){g(n,a);function n(r){var t=a.call(this,r)||this;return t.additionalEvents=[],t.properties=[],t.meta={},t.setInitialParams=function(){t.setMeta("UID",u.getUid()).setMeta("DTSTAMP",s.getTimeCreated()).addProperty("CLASS","PUBLIC").addProperty("DESCRIPTION",u.formatText(t.description)).addProperty("LOCATION",u.formatText(t.location)).addProperty("SUMMARY",u.formatText(t.title)).addProperty("TRANSP","TRANSPARENT"),t.isAllDay?t.addProperty("DTSTART;VALUE=DATE",s.formatDateNoUtc(t.start,c.DATE)).addProperty("DTEND;VALUE=DATE",s.formatDateNoUtc(s.incrementDate(t.start,1),c.DATE)):t.addProperty("DTSTART",s.formatDate(t.start,c.FULL)).addProperty("DTEND",s.formatDate(t.end,c.FULL)),t.recurrence&&t.addProperty("RRULE",u.getRrule(t.recurrence)),t.attendees.length>0&&t.attendees.forEach(function(e){var i=e.email,o=e.name,m=e.icsOptions,y=m===void 0?{}:m,P=t.getAttendeeParams(y,o),L="MAILTO:".concat(i);t.addProperty(P,L)})},t.getAttendeeParams=function(e,i){var o={};i&&(o.CN=i),e.delegatedFrom&&(o["DELEGATED-FROM"]=e.delegatedFrom),e.partStat&&(o.PARTSTAT=e.partStat),e.role&&(o.ROLE=e.role),e.sentBy&&(o["SENT-BY"]=e.sentBy),o.RSVP=e.rsvp?"TRUE":"FALSE";var m=f.toParamString(o,";");return"ATTENDEE;".concat(m)},t.getAlarmDuration=function(e){var i=["".concat(e.weeks,"W"),"".concat(e.days,"D"),"".concat(e.hours,"H"),"".concat(e.minutes,"M"),"".concat(e.seconds,"S")].filter(function(o){return/^[0-9]+[A-Z]$/.exec(o)});return i.unshift(e.after?"PT":"-PT"),i.join("")},t.getMeta=function(){return Object.keys(t.meta).map(function(e){return"".concat(e,":").concat(t.meta[e])})},t.setMeta=function(e,i){return t.meta[e]=i,t},t.addEvent=function(e){return t.additionalEvents.push(e),t},t.addProperty=function(e,i){if(typeof i=="object"){t.properties.push("BEGIN:".concat(e));for(var o in i)t.addProperty(o,i[o]);t.properties.push("END:".concat(e))}else t.properties.push("".concat(e,":").concat(i.toString()));return t},t.addAlarm=function(e){var i={ACTION:e.action};if(e.description&&(i.DESCRIPTION=u.formatText(e.description)),e.summary&&(i.SUMMARY=u.formatText(e.summary)),e.duration&&(i.DURATION=t.getAlarmDuration(e.duration)),e.repeat&&(i.REPEAT=e.repeat),e.attach){var o=e.attach.params?"ATTACH;".concat(e.attach.params):"ATTACH";i[o]=e.attach.url}return e.trigger instanceof Date?i["TRIGGER;VALUE=DATE-TIME"]=s.formatDate(e.trigger,c.FULL):i.TRIGGER=t.getAlarmDuration(e.trigger),t.addProperty("VALARM",i)},t.render=function(){var e=l([t],t.additionalEvents,!0),i=e.reduce(function(o,m){return l(l(l(l(l([],o,!0),["BEGIN:VEVENT"],!1),m.properties,!0),m.getMeta(),!0),["END:VEVENT"],!1)},[]);return l(l(["BEGIN:VCALENDAR","VERSION:2.0"],i,!0),["PRODID:".concat(u.getProdId()),"END:VCALENDAR"],!1).join(`
`)},t.setInitialParams(),t}return n}(v);const W=O({name:"CalendarButton",components:{BaseButton:I},props:{isAllDay:{type:Boolean,required:!1,default:!1},startDate:{type:String,default:void 0},startDatetime:{type:String,default:void 0},endDatetime:{type:String,required:!1,default:void 0},title:{type:String,required:!1,default:void 0},location:{type:String,required:!1,default:void 0},description:{type:String,required:!1,default:void 0}},data(){return{icalendar:void 0,options:void 0}},computed:{icsDescription(){return`${(this.description?this.description+`

`:"")+(window==null?void 0:window.location.href)}`}},mounted(){this.init()},methods:{init(){let a;if(this.isAllDay&&this.endDatetime||this.startDate&&this.endDatetime){const n=this.startDatetime?D(this.startDatetime):D(this.startDate).tz("America/Los_Angeles");a={frequency:"DAILY",interval:1,count:D(this.endDatetime).diff(n,"day")+1}}this.options={title:this.title?this.title:void 0,location:this.location?this.location:void 0,description:this.icsDescription,start:this.startDatetime?new Date(D(this.startDatetime)):this.startDate?new Date(D(this.startDate).tz("America/Los_Angeles")):new Date,end:!this.isAllDay&&this.endDatetime?new Date(this.endDatetime):void 0,recurrence:a},this.icalendar=new $(this.options)},handleDownload(){const a=this.icalendar.render(),n=new Blob([a],{type:"text/calendar"}),r=window.URL.createObjectURL(n);let t=document.createElement("a");t.href=r,t.download=N.kebabCase(this.title),t.click()}}});function z(a,n,r,t,e,i){const o=Y("BaseButton");return S(),M(o,{ref:"CalendarButton",class:"w-full",variant:"secondary",compact:"",onClick:a.handleDownload},{default:C(()=>n[0]||(n[0]=[R(" Add to calendar ")])),_:1},8,["onClick"])}const et=U(W,[["render",z]]);export{et as C};
